#include <stdio.h>    /* entrées sorties */
#include <unistd.h>   /* pimitives de base : fork, ...*/
#include <stdlib.h>   /* exit */
#include <sys/wait.h> /* wait */
#include <string.h>   /* opérations sur les chaines */
#include <fcntl.h>    /* opérations sur les fichiers */

int main(){
    char fichierOriginal[] = "Original_fichier.txt";
    char Nouveaufichier[] = "Nouveau_fichier.txt";
    char buffer[10] ;
    bzero(buffer, sizeof(buffer)) ;
    
    /* ouverture du fichier Original_fichier.txt en lecture */
    int desc_Original = open(fichierOriginal, O_RDONLY) ;
    perror("Opening Error Original_fichier");
    
    /* ouverture du fichier Nouveaufichier.txt en ecriture */
    int desc_Nouveau= open(Nouveaufichier,O_WRONLY);
    perror("Opening Error Nouveau_fichier");
    
    /* traiter systématiquement les retours d'erreur des appels */
    if (desc_Original < 0) {
        printf("Erreur ouverture Original_fichier %s\n", fichierOriginal) ;
        exit(1) ;
    }
    if (desc_Nouveau < 0) {
        printf("Erreur ouverture Nouveau_fichier %s\n", Nouveaufichier) ;
        exit(1) ;
    }
    
    /* Lecture */
    while (read(desc_Original,buffer,4) > 0) {
        printf("\n");
        perror("Read Error Original_fichier");
        /* La copie */
        write(desc_Nouveau,buffer,4);
        perror("Writing Error Nouveau_fichier");
        bzero(buffer,sizeof(buffer));
        bzero(buffer,sizeof(buffer));
    }
    
    printf("\nLe resultat du programme est dans Nouveau_fichier.txt\n");
    /* Fermiture du fichier Original_fichier.txt */
    close(desc_Original);
    perror("Closing Error Original_fichier");
    /* Fermiture du fichier Nouveaufichier.txt */
    close(desc_Nouveau);
    perror("Closing Error Nouveau_fichier");
}
